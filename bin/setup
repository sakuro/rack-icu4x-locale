#!/usr/bin/env zsh

autoload -U colors
colors
# prefix for -x
PS4="${fg[cyan]}[$0:t]$reset_color "
# prefix for stdout
exec > >(sed -e "s/^/${fg[magenta]}[$0:t]$reset_color /")

IFS=$'\n\t'
set -euxo pipefail

bundle install

if [ -z "${ICU4X_DATA_PATH+x}" ]; then
  ICU4X_DATA_PATH="$(bundle show icu4x-data-recommended)/data/recommended.postcard"
  if [ ! -f .env ]; then
    echo "ICU4X_DATA_PATH=$ICU4X_DATA_PATH" > .env
    echo "ICU4X_DATA_PATH is set to $ICU4X_DATA_PATH in .env"
  else
    echo "Add following setting to your .env"
    echo 'ICU4X_DATA_PATH="'$ICU4X_DATA_PATH'"'
  fi
else
  echo "ICU4X_DATA_PATH is $ICU4X_DATA_PATH"
fi

if [ ! -f "$ICU4X_DATA_PATH" ]; then
  echo "ICU4X_DATA_PATH($ICU4X_DATA_PATH) does not exist."
  exit 1
fi
